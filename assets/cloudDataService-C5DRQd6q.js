import{x as D,y as v,z as U,I as _,J as w,L as E,N as g,O as I,Q as S,V as C,Y as k}from"./vendor-f07bxsqa.js";import{i as H,s as h,c as Y,g as B}from"./index-laPszZKe.js";const x={apiKey:"AIzaSyC3T9M61Ryll8scTGVWH5QdZKuAguWTzgw",authDomain:"studentgradetracker-e04c0.firebaseapp.com",projectId:"studentgradetracker-e04c0",storageBucket:"studentgradetracker-e04c0.firebasestorage.app",messagingSenderId:"886408200590",appId:"1:886408200590:web:c9fbdb028e5dcd442c64df"};let T,p;const z=()=>{try{return D().length===0?T=v(x):T=D()[0],p=U(T),_(p).catch(s=>{s.code==="failed-precondition"?console.warn("Firestore persistence failed: Multiple tabs open"):s.code==="unimplemented"&&console.warn("Firestore persistence not available in this browser")}),{app:T,db:p}}catch(s){return console.error("Firebase initialization error:",s),{app:null,db:null}}},R=z(),f=()=>{try{return p||(R&&R.db?R.db:null)}catch(s){return console.warn("Firebase DB not available:",s),null}},n={STUDENTS:"students",COURSES:"courses",ENROLLMENTS:"enrollments",ASSESSMENTS:"assessments",GRADES:"grades",SYNC_STATUS:"syncStatus"},a={STUDENTS:"nlac_students",COURSES:"nlac_courses",ENROLLMENTS:"nlac_enrollments",ASSESSMENTS:"nlac_assessments",GRADES:"nlac_grades",LAST_SYNC:"nlac_last_sync",SYNC_ENABLED:"nlac_sync_enabled"},O=()=>({students:[{id:1,studentIdNum:"2024-0001",name:"Garcia, Maria S.",program:"BSCS",pinCode:"4521",yearLevel:"1st Year",email:""},{id:2,studentIdNum:"2024-0002",name:"Wilson, James K.",program:"BSIT",pinCode:"7832",yearLevel:"2nd Year",email:""},{id:3,studentIdNum:"2024-0003",name:"Chen, Robert L.",program:"BS MATH",pinCode:"9012",yearLevel:"3rd Year",email:""}],courses:[{id:101,title:"Mathematics 101",code:"MATH101",type:"Lecture",day:"MWF",time:"09:00 - 10:00",room:"Room 301"},{id:102,title:"Computer Science",code:"CS202",type:"Lab",day:"TTh",time:"13:00 - 15:00",room:"Lab 101"}],enrollments:[{id:"en-1",studentId:1,courseId:101},{id:"en-2",studentId:1,courseId:102},{id:"en-3",studentId:2,courseId:101},{id:"en-4",studentId:3,courseId:101}],assessments:[{id:501,courseId:101,category:"Written Exam",title:"Prelim Exam",month:"February",hps:100,date:"2024-02-15",instructorComments:"Covers chapters 1-3, focus on basic concepts"},{id:502,courseId:101,category:"Written Exam",title:"Quiz 1",month:"February",hps:50,date:"2024-02-20",instructorComments:"Short quiz on algebraic equations"},{id:503,courseId:101,category:"Performance Task",title:"Seatwork",month:"February",hps:20,date:"2024-02-22",instructorComments:"Daily practice exercises"},{id:504,courseId:102,category:"Written Exam",title:"Prelim Exam",month:"February",hps:100,date:"2024-02-16",instructorComments:"Programming fundamentals and algorithms"},{id:505,courseId:102,category:"Performance Task",title:"Lab Exercise 1",month:"February",hps:50,date:"2024-02-21",instructorComments:"Basic programming lab assignment"}],grades:[{id:"g1",studentId:1,assessmentId:501,score:95},{id:"g2",studentId:2,assessmentId:501,score:88},{id:"g3",studentId:1,assessmentId:502,score:45},{id:"g4",studentId:1,assessmentId:503,score:18},{id:"g5",studentId:2,assessmentId:504,score:92}]}),u=(s,r)=>{try{const e=localStorage.getItem(s);return e?JSON.parse(e):r?(localStorage.setItem(s,JSON.stringify(r)),r):[]}catch(e){return console.error(`Error loading ${s} from localStorage:`,e),r||[]}},c=(s,r)=>{try{return localStorage.setItem(s,JSON.stringify(r)),!0}catch(e){return console.error(`Error saving ${s} to localStorage:`,e),!1}},y=()=>localStorage.getItem(a.SYNC_ENABLED)==="true",M=s=>{localStorage.setItem(a.SYNC_ENABLED,s?"true":"false")},L=async(s=null)=>{const r=f();if(!r)return console.warn("Firebase not available, skipping cloud upload"),{success:!1,error:"Firebase not available"};let e;s?e=s:e={students:u(a.STUDENTS,[]),courses:u(a.COURSES,[]),enrollments:u(a.ENROLLMENTS,[]),assessments:u(a.ASSESSMENTS,[]),grades:u(a.GRADES,[])},(!e.students||e.students.length===0)&&(e=O());try{const t=w(r);for(const o of e.students){const l=E(r,n.STUDENTS,o.id.toString());t.set(l,o)}for(const o of e.courses){const l=E(r,n.COURSES,o.id.toString());t.set(l,o)}for(const o of e.enrollments){const l=E(r,n.ENROLLMENTS,o.id);t.set(l,o)}for(const o of e.assessments){const l=E(r,n.ASSESSMENTS,o.id.toString());t.set(l,o)}for(const o of e.grades){const l=E(r,n.GRADES,o.id);t.set(l,o)}return await t.commit(),localStorage.setItem(a.LAST_SYNC,new Date().toISOString()),console.log("✅ All data uploaded to Firebase successfully!"),{success:!0}}catch(t){return console.error("Error uploading to Firebase:",t),{success:!1,error:t.message}}},F=async()=>{const s=f();if(!s)return console.warn("Firebase not available, skipping cloud download"),{success:!1,error:"Firebase not available"};try{const e=(await g(I(S(s,n.STUDENTS),C("id")))).docs.map(i=>({id:parseInt(i.id),...i.data()})),o=(await g(I(S(s,n.COURSES),C("id")))).docs.map(i=>({id:parseInt(i.id),...i.data()})),d=(await g(S(s,n.ENROLLMENTS))).docs.map(i=>({id:i.id,...i.data()})),m=(await g(I(S(s,n.ASSESSMENTS),C("id")))).docs.map(i=>({id:parseInt(i.id),...i.data()})),A=(await g(S(s,n.GRADES))).docs.map(i=>({id:i.id,...i.data()}));return c(a.STUDENTS,e),c(a.COURSES,o),c(a.ENROLLMENTS,d),c(a.ASSESSMENTS,m),c(a.GRADES,A),localStorage.setItem(a.LAST_SYNC,new Date().toISOString()),console.log("✅ All data downloaded from cloud successfully!"),{success:!0,data:{students:e,courses:o,enrollments:d,assessments:m,grades:A}}}catch(r){return console.error("Error downloading from cloud:",r),{success:!1,error:r.message}}},P=async(s,r)=>{const e=f();if(!e)return console.warn("Firebase not available, skipping sync"),{success:!1,error:"Firebase not available"};if(!y())return console.log("Cloud sync is disabled, saving to localStorage only"),{success:!1,reason:"disabled"};try{const t=w(e),o=S(e,s);return(await g(o)).docs.forEach(d=>{t.delete(d.ref)}),r.forEach(d=>{const b=E(o,d.id.toString());t.set(b,d)}),await t.commit(),localStorage.setItem(a.LAST_SYNC,new Date().toISOString()),console.log(`✅ ${s} synced to cloud!`),{success:!0}}catch(t){return console.error(`Error syncing ${s}:`,t),{success:!1,error:t.message}}},W=async(s,r)=>{const e=f();if(!e)return console.warn("Firebase not available, skipping sync"),{success:!1,error:"Firebase not available"};try{const o=(await g(S(e,s))).docs.map(l=>{const d=l.data();return s===n.ENROLLMENTS||s===n.GRADES?{id:l.id,...d}:{id:parseInt(l.id),...d}});return c(r,o),{success:!0,data:o}}catch(t){return console.error(`Error syncing ${s} from cloud:`,t),{success:!1,error:t.message}}},G=()=>localStorage.getItem(a.LAST_SYNC),J=s=>{const r=f();if(!r)return console.warn("Firebase not available, skipping cloud listener"),()=>{};if(!y())return()=>{};const t=[{name:n.STUDENTS,key:a.STUDENTS},{name:n.COURSES,key:a.COURSES},{name:n.ENROLLMENTS,key:a.ENROLLMENTS},{name:n.ASSESSMENTS,key:a.ASSESSMENTS},{name:n.GRADES,key:a.GRADES}].map(({name:o,key:l})=>k(S(r,o),d=>{const b=d.docs.map(m=>{const N=m.data();return o===n.ENROLLMENTS||o===n.GRADES?{id:m.id,...N}:{id:parseInt(m.id),...N}});c(l,b),s({collection:o,data:b})}));return()=>t.forEach(o=>o())},$=()=>{const s=y()?"available":"disabled",r=B();return{firebase:s,github:r,lastSync:G()}},K=async()=>{M(!0),await H();const s=localStorage.getItem(a.STUDENTS);try{const e=await F();if(e.success&&e.data&&e.data.students.length>0){console.log("✅ Data loaded from Firebase cloud successfully!");try{await h(e.data),console.log("✅ Data backed up to GitHub Cloud")}catch(t){console.log("GitHub backup failed:",t)}return e.data}}catch{console.log("Firebase download not available, trying GitHub Cloud...");try{const t=await Y();if(t.success&&t.data&&t.data.students.length>0)return console.log("✅ Data loaded from GitHub Cloud successfully!"),c(a.STUDENTS,t.data.students),c(a.COURSES,t.data.courses),c(a.ENROLLMENTS,t.data.enrollments),c(a.ASSESSMENTS,t.data.assessments),c(a.GRADES,t.data.grades),t.data}catch{console.log("GitHub Cloud not available, using local data")}}if(s)try{const e={students:u(a.STUDENTS),courses:u(a.COURSES),enrollments:u(a.ENROLLMENTS),assessments:u(a.ASSESSMENTS),grades:u(a.GRADES)};return L().catch(t=>console.log("Firebase upload failed:",t)),h(e).catch(t=>console.log("GitHub upload failed:",t)),e}catch(e){console.error("Error loading local data:",e)}const r=O();c(a.STUDENTS,r.students),c(a.COURSES,r.courses),c(a.ENROLLMENTS,r.enrollments),c(a.ASSESSMENTS,r.assessments),c(a.GRADES,r.grades);try{await L(),console.log("✅ Sample data uploaded to Firebase")}catch(e){console.log("Initial Firebase upload failed:",e)}try{await h(r),console.log("✅ Sample data uploaded to GitHub Cloud")}catch(e){console.log("Initial GitHub upload failed:",e)}return r},q=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),j={loadFromLocalStorage:u,saveToLocalStorage:c,isCloudSyncEnabled:y,setCloudSyncEnabled:M,uploadAllToCloud:L,downloadAllFromCloud:F,syncCollectionToCloud:P,syncCollectionFromCloud:W,getLastSyncTime:G,setupCloudListener:J,initializeData:K,isMobileDevice:q,getCloudStatus:$,COLLECTIONS:n,STORAGE_KEYS:a};export{n as COLLECTIONS,a as STORAGE_KEYS,j as default,F as downloadAllFromCloud,$ as getCloudStatus,G as getLastSyncTime,K as initializeData,y as isCloudSyncEnabled,q as isMobileDevice,u as loadFromLocalStorage,c as saveToLocalStorage,M as setCloudSyncEnabled,J as setupCloudListener,W as syncCollectionFromCloud,P as syncCollectionToCloud,L as uploadAllToCloud};
